<html>

<head>
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
  <link rel="stylesheet" as="style" onload="this.rel='stylesheet'"
    href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter%3Awght%40400%3B500%3B700%3B900&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900" />

  <title>Galileo Design</title>
  <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />

  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <style>
    .bg-active {
      background-color: #f0f2f4;
      font-weight: 600;
      border-left: 4px solid #2563eb;
      /* blue-600 */
    }
  </style>
</head>

<body class="bg-white font-sans">
  <div class="relative flex size-full min-h-screen flex-col bg-white group/design-root overflow-x-hidden"
    style="font-family: Inter, 'Noto Sans', sans-serif">
    <div class="layout-container flex h-full grow flex-col">
      <div class="gap-1 px-6 flex flex-1 justify-center py-5">
        <div class="layout-content-container flex flex-col w-80">
          <div class="flex h-full min-h-[700px] flex-col justify-between bg-white p-4">
            <div class="flex flex-col gap-4">
              <div class="flex gap-3">
                <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10"
                  style="background-image: url('https://cdn.usegalileo.ai/sdxl10/8df52227-0586-455a-ba76-fef9fda944ea.png');">
                </div>
                <h1 class="text-gray-800 text-base font-medium leading-normal">
                  Craftsmen Network
                </h1>
              </div>
              <div class="flex flex-col gap-2">
                <a href="/dashboardAdmin.html"
                  class="transition-colors duration-200 ease-in-out flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-gray-100 group">
                  <div class="text-gray-800">
                    <!-- Dashboard icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor"
                      viewBox="0 0 256 256">
                      <path
                        d="M218.83,103.77l-80-75.48a1.14,1.14,0,0,1-.11-.11,16,16,0,0,0-21.53,0l-.11.11L37.17,103.77A16,16,0,0,0,32,115.55V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V160h32v48a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V115.55A16,16,0,0,0,218.83,103.77ZM208,208H160V160a16,16,0,0,0-16-16H112a16,16,0,0,0-16,16v48H48V115.55l.11-.1L128,40l79.9,75.43.11.1Z">
                      </path>
                    </svg>
                  </div>

                  <p class="text-sm font-medium text-gray-800">Dashboard</p>
                </a>

                <a href="/ContentModeration.html"
                  class="transition-colors duration-200 ease-in-out flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-gray-100 group">
                  <div class="text-gray-800">
                    <!-- Broom Icon (Content Moderation) -->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="24px" height="24px"
                      viewBox="0 0 256 256">
                      <path
                        d="M231.3,24.69a8,8,0,0,0-11.31,0l-64,64L146.34,82.34l9.36-9.37a8,8,0,0,0-11.32-11.31l-9.36,9.36L64,17.37A8,8,0,0,0,52.69,28.69L126.63,102.6l-93.6,93.6a8,8,0,0,0,11.31,11.31l93.6-93.6L227.31,40A8,8,0,0,0,231.3,24.69Z" />
                    </svg>
                  </div>
                  <p class="text-sm font-medium text-gray-800">Content Moderation</p>

                </a>


                <a href="/ManageUser.html"
                  class="transition-colors duration-200 ease-in-out flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-gray-100 group">
                  <div class="text-gray-800">
                    <!-- User icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="24px" height="24px"
                      viewBox="0 0 256 256">
                      <path
                        d="M230.92,212c-15.23-26.33-38.7-45.21-66.09-54.16a72,72,0,1,0-73.66,0C63.78,166.78,40.31,185.66,25.08,212a8,8,0,1,0,13.85,8c18.84-32.56,52.14-52,89.07-52s70.23,19.44,89.07,52a8,8,0,1,0,13.85-8ZM72,96a56,56,0,1,1,56,56A56.06,56.06,0,0,1,72,96Z">
                      </path>
                    </svg>
                  </div>
                  <p class="text-sm font-medium text-gray-800"> Manage Users</p>

                </a>

                <a href="/reportAdmin.html"
                  class="transition-colors duration-200 ease-in-out flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-gray-100 group">
                  <div class="text-gray-800">
                    <!-- Report icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="24px" height="24px"
                      viewBox="0 0 256 256">
                      <path
                        d="M224,48V168a8,8,0,0,1-2.76,6c-15.28,13.23-29.89,18-43.82,18-18.91,0-36.57-8.74-53-16.85C97.87,162,74.79,150.61,48,171.77V216a8,8,0,0,1-16,0V48a8,8,0,0,1,2.77-6h0c36-31.18,68.31-15.21,96.79-1.12C159,54.46,182.79,66.2,210.76,42A8,8,0,0,1,224,48Z">
                      </path>
                    </svg>
                  </div>

                  <p class="text-sm font-medium text-gray-800">Reports</p>
                </a>

                <a href="/skilladmin.html"
                  class="transition-colors duration-200 ease-in-out flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-gray-100 group">
                  <div class="text-gray-800">
                    <!-- Settings icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor"
                      viewBox="0 0 256 256">
                      <path
                        d="M128,80a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Z">
                      </path>
                    </svg>
                  </div>

                  <p class="text-sm font-medium text-gray-800">Skills & Categories</p>

                </a>
              </div>
            </div>
          </div>
        </div>

        <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
          <h1 class="text-2xl font-bold text-gray-800 mb-4">Manage Users</h1>

          <div class="mb-4">
            <input id="searchInput" type="text" placeholder="Search by name or email..."
              class="w-full max-w-md p-2 border border-gray-300 rounded" />
          </div>

          <div class="overflow-x-auto rounded border bg-white">
            <table class="min-w-full">
              <thead class="bg-gray-100">
                <tr>
                  <th class="p-3 text-left text-sm font-medium text-gray-700">User</th>
                  <th class="p-3 text-left text-sm font-medium text-gray-700">Full Name</th>
                  <th class="p-3 text-left text-sm font-medium text-gray-700">Email</th>
                  <th class="p-3 text-left text-sm font-medium text-gray-700">Role</th>
                  <th class="p-3 text-left text-sm font-medium text-gray-700">Status</th>
                  <th class="p-3 text-left text-sm font-medium text-gray-700">Actions</th>
                </tr>
              </thead>
              <tbody id="userTableBody">
                <tr>
                  <td colspan="6" class="p-4 text-center text-gray-500">Loading users...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>
  </div>
  <script>
    let allUsers = [];

    document.addEventListener("DOMContentLoaded", async () => {
      await loadUsers();

      document.getElementById("searchInput").addEventListener("input", filterUsers);
    });

    async function loadUsers() {
      try {
        const res = await fetch('/api/admin/users/all');
        allUsers = await res.json();
        renderUsers(allUsers);
      } catch (error) {
        console.error('Failed to load users:', error);
      }
    }

    function filterUsers() {
      const query = document.getElementById("searchInput").value.toLowerCase();
      const filtered = allUsers.filter(user =>
        user.fullName.toLowerCase().includes(query) || user.email.toLowerCase().includes(query)
      );
      renderUsers(filtered);
    }

    function renderUsers(users) {
      const tbody = document.getElementById("userTableBody");
      tbody.innerHTML = "";

      if (users.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6" class="p-4 text-center text-gray-500">No users found</td></tr>`;
        return;
      }

      users.forEach(user => {
        tbody.innerHTML += `
          <tr class="border-t border-t-[#dce1e5]">
            <td class="px-4 py-2 w-14">
              <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full w-10" 
                style="background-image: url('${user.profileImage}')">
              </div>
            </td>
            <td class="px-4 py-2 text-sm text-[#111517]">${user.fullName}</td>
            <td class="px-4 py-2 text-sm text-[#647787]">${user.email}</td>
            <td class="px-4 py-2 text-sm">
              <button class="rounded-xl bg-[#f0f2f4] px-4 py-1" onclick="editRole('${user._id}', '${user.role}')">${user.role}</button>
            </td>
            <td class="px-4 py-2 text-sm">
              <button class="rounded-xl bg-[#f0f2f4] px-4 py-1" onclick="toggleBan('${user._id}', '${user.status}')">${user.status}</button>
            </td>
            <td class="px-4 py-2 text-sm text-[#647787] font-bold">
              <button class="text-blue-600 hover:underline" onclick="editRole('${user._id}', '${user.role}')">Edit</button> |
              <button class="text-red-600 hover:underline" onclick="toggleBan('${user._id}', '${user.status}')">${user.status === 'Banned' ? 'Unban' : 'Ban'}</button> |
              <button class="text-gray-600 hover:underline" onclick="deleteUser('${user._id}')">Remove</button>
            </td>
          </tr>`;
      });
    }

    async function editRole(id, currentRole) {
      const newRole = prompt('Enter new role (Admin, Client, Craftsman):', currentRole);
      if (!newRole || newRole === currentRole) return;
      await fetch(`/api/admin/users/${id}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ role: newRole })
      });
      await loadUsers();
    }

    async function toggleBan(id, currentStatus) {
      const newStatus = currentStatus === 'Banned' ? 'Active' : 'Banned';
      await fetch(`/api/admin/users/${id}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ status: newStatus })
      });
      await loadUsers();
    }

    async function deleteUser(id) {
      if (!confirm('Are you sure you want to delete this user?')) return;
      await fetch(`/api/admin/users/${id}`, { method: 'DELETE' });
      await loadUsers();
    }
  </script>

  <script>
    const path = window.location.pathname;
    document.querySelectorAll("a").forEach(link => {
      if (link.getAttribute("href") === path) {
        link.classList.add("bg-active", "text-blue-600");
      }
    });
  </script>

</body>

</html>