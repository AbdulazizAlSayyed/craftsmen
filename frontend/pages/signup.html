<html>
  <head>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter%3Awght%40400%3B500%3B700%3B900&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900"
    />

    <title>Galileo Design</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>

  <body>
    <div
      class="relative flex size-full min-h-screen flex-col bg-white group/design-root overflow-x-hidden"
      style="
        --checkbox-tick-svg: url('data:image/svg+xml,%3csvg viewBox=%270 0 16 16%27 fill=%27rgb(255,255,255)%27 xmlns=%27http://www.w3.org/2000/svg%27%3e%3cpath d=%27M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z%27/%3e%3c/svg%3e');
        --select-button-svg: url('data:image/svg+xml,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2724px%27 height=%2724px%27 fill=%27rgb(99,117,136)%27 viewBox=%270 0 256 256%27%3e%3cpath d=%27M181.66,170.34a8,8,0,0,1,0,11.32l-48,48a8,8,0,0,1-11.32,0l-48-48a8,8,0,0,1,11.32-11.32L128,212.69l42.34-42.35A8,8,0,0,1,181.66,170.34Zm-96-84.68L128,43.31l42.34,42.35a8,8,0,0,0,11.32-11.32l-48-48a8,8,0,0,0-11.32,0l-48,48A8,8,0,0,0,85.66,85.66Z%27%3e%3c/path%3e%3c/svg%3e');
        font-family: Inter, 'Noto Sans', sans-serif;
      "
    >
      <div class="layout-container flex h-full grow flex-col">
        <header
          class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#f3ece7] px-10 py-3"
        >
          <div class="flex items-center gap-4 text-[#1b130d]">
            <div class="size-4">
              <svg
                viewBox="0 0 48 48"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M12.0799 24L4 19.2479L9.95537 8.75216L18.04 13.4961L18.0446 4H29.9554L29.96 13.4961L38.0446 8.75216L44 19.2479L35.92 24L44 28.7521L38.0446 39.2479L29.96 34.5039L29.9554 44H18.0446L18.04 34.5039L9.95537 39.2479L4 28.7521L12.0799 24Z"
                  fill="currentColor"
                ></path>
              </svg>
            </div>
            <h2
              class="text-[#1b130d] text-lg font-bold leading-tight tracking-[-0.015em]"
            >
              Craftsman
            </h2>
          </div>
          <div class="flex flex-1 justify-end gap-8">
            <div class="flex gap-2">
              <a href="signup.html">
                <button
                  class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 bg-[#ee7f2b] text-[#1b130d] text-sm font-bold leading-normal tracking-[0.015em]"
                >
                  <span class="truncate">Sign up</span>
                </button>
              </a>
              <a href="log-in.html">
                <button
                  class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 bg-[#f3ece7] text-[#1b130d] text-sm font-bold leading-normal tracking-[0.015em]"
                >
                  <span class="truncate">Log in</span>
                </button>
              </a>
            </div>
          </div>
        </header>

        <div class="px-40 flex flex-1 justify-center py-5">
          <div
            class="layout-content-container flex flex-col w-[512px] max-w-[512px] py-5 max-w-[960px] py-5flex-1"
          >
            <h3
              class="text-[#111418] tracking-light text-2xl font-bold leading-tight px-4 text-left pb-2 pt-5"
            >
              Create an account
            </h3>
            <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
              <label class="flex flex-col min-w-40 flex-1">
                <p
                  class="text-[#111418] text-base font-medium leading-normal pb-2"
                >
                  Full name <span class="text-red-500">*</span>
                </p>
                <input
                  placeholder="Full name"
                  class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                  value=""
                />
              </label>
            </div>
            <p
              class="text-[#637588] text-sm font-normal leading-normal pb-3 pt-1 px-4"
            >
              Your full name will be publicly visible
            </p>
            <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
              <label class="flex flex-col min-w-40 flex-1">
                <p
                  class="text-[#111418] text-base font-medium leading-normal pb-2"
                >
                  Email <span class="text-red-500">*</span>
                </p>
                <input
                  placeholder="Email"
                  class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                  value=""
                />
              </label>
            </div>
            <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
              <label class="flex flex-col min-w-40 flex-1">
                <p
                  class="text-[#111418] text-base font-medium leading-normal pb-2"
                >
                  Phone number <span class="text-red-500">*</span>
                </p>
                <input
                  placeholder="Phone number"
                  class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                  value=""
                />
              </label>
            </div>
            <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
              <label class="flex flex-col min-w-40 flex-1">
                <p
                  class="text-[#111418] text-base font-medium leading-normal pb-2"
                >
                  Password <span class="text-red-500">*</span>
                </p>
                <input
                  id="signupPassword"
                  placeholder="Password"
                  class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                  oninput="updateSignupStrengthBar()"
                  type="password"
                />
              </label>
            </div>

            <!-- Password strength bar -->
            <div class="flex flex-col gap-3 px-4 -mt-3 mb-4">
              <div class="flex justify-between">
                <p class="text-[#1b140e] text-sm font-medium leading-normal">
                  Password strength
                </p>
              </div>
              <div class="rounded bg-[#e7dbd0] h-2">
                <div
                  id="signup-strength-bar"
                  class="h-2 rounded bg-[#e68019]"
                  style="width: 0%"
                ></div>
              </div>
            </div>

            <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
              <label class="flex flex-col min-w-40 flex-1">
                <p
                  class="text-[#111418] text-base font-medium leading-normal pb-2"
                >
                  I'm a...
                </p>
                <select
                  class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                >
                  <option value="client">Client</option>
                  <option value="craftsman">Craftman</option>
                </select>
              </label>
            </div>
            <!-- Skills Selection with Checkboxes -->
            <!-- Skills Selection Dynamic -->
            <label id="skills-wrapper" class="flex flex-col px-4 py-3">
              <p class="text-base font-medium pb-2">Select your skills</p>
              <div id="skills-container" class="grid grid-cols-2 gap-2">
                <!-- Skills will be dynamically inserted here -->
              </div>
            </label>

            <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
              <label class="flex flex-col min-w-40 flex-1">
                <p
                  class="text-[#111418] text-base font-medium leading-normal pb-2"
                >
                  Bio
                </p>
                <textarea
                  placeholder="Tell people about yourself in a few sentences"
                  class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none min-h-36 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                ></textarea>
              </label>
            </div>
            <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
              <label class="flex flex-col min-w-40 flex-1">
                <p
                  class="text-[#111418] text-base font-medium leading-normal pb-2"
                >
                  Location
                </p>
                <input
                  placeholder="Where are you based?"
                  class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                  value=""
                />
              </label>
            </div>
            <div class="px-4">
              <label class="flex gap-x-3 py-3 flex-row">
                <input
                  type="checkbox"
                  class="h-5 w-5 rounded border-[#ee7f2b] border-2 bg-transparent text-[#1980e6] checked:bg-[#ee7f2b] checked:border-bg-[#ee7f2b] checked:bg-[image:--checkbox-tick-svg] focus:ring-0 focus:ring-offset-0 focus:border-[#dce0e5] focus:outline-none"
                />
                <p class="text-[#111418] text-base font-normal leading-normal">
                  Yes, I'd like to receive more information from Craftsmen
                </p>
              </label>
            </div>
            <div class="flex px-4 py-3">
              <button
                onclick="registerUser()"
                class="flex min-w-[200px] max-w-[600px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 flex-1 bg-[#ee7f2b] text-white text-sm font-bold leading-normal tracking-[0.015em]"
              >
                <span class="truncate">Get started</span>
              </button>

              <script>
                async function registerUser() {
                  const fullName = document.querySelector(
                    "input[placeholder='Full name']"
                  ).value;
                  const email = document.querySelector(
                    "input[placeholder='Email']"
                  ).value;
                  const phoneNumber = document.querySelector(
                    "input[placeholder='Phone number']"
                  ).value;
                  const password = document.querySelector(
                    "input[placeholder='Password']"
                  ).value;
                  const role = document.querySelector("select").value;
                  const bio = document.querySelector("textarea").value;
                  const location = document.querySelector(
                    "input[placeholder='Where are you based?']"
                  ).value;
                  const newsletterSubscribed =
                    document.querySelectorAll("input[type='checkbox']")[1]
                      ?.checked ?? false;

                  const selectedSkillElements = Array.from(
                    document.querySelectorAll("input[name='skills']:checked")
                  );
                  const selectedSkillNames = selectedSkillElements.map(
                    (el) => el.value
                  );

                  let skills = [];

                  if (!selectedSkillNames.includes("No skills")) {
                    skills = selectedSkillNames.map((name) => ({
                      name,
                      rank: "Beginner",
                      experience: 0,
                      rating: 0,
                      numberOfJobs: 0,
                      numberOfRatedJobs: 0,
                    }));
                  }

                  const response = await fetch(
                    "http://localhost:5001/api/auth/signup",
                    {
                      method: "POST",
                      headers: { "Content-Type": "application/json" },
                      body: JSON.stringify({
                        fullName,
                        email,
                        phoneNumber,
                        password,
                        role,
                        skills,
                        bio,
                        location,
                        newsletterSubscribed,
                      }),
                    }
                  );

                  const data = await response.json();
                  console.log("🔍 Server response:", data); // ✅ Debugging

                  if (response.ok) {
                    await Swal.fire({
                      icon: "success",
                      title: "Account Created 🎉",
                      text: "Please verify your email to continue.",
                      timer: 2000,
                      timerProgressBar: true,
                      showConfirmButton: false,
                      background: "#ecfdf5",
                      backdrop: `rgba(34,197,94,0.2)`,
                      didOpen: () => {
                        Swal.showLoading();
                      },
                    });

                    localStorage.setItem("emailToVerify", email);
                    window.location.href = "verification-email.html";
                  } else {
                    await Swal.fire({
                      icon: "error",
                      title: "Signup Failed",
                      text: data.message || "Something went wrong.",
                      confirmButtonColor: "#ec7113",
                      background: "#ffffff",
                      backdrop: `rgba(0, 0, 0, 0.4)`,
                    });
                  }
                }
              </script>
            </div>
          </div>
        </div>

        <footer class="flex justify-center">
          <div class="flex max-w-[960px] flex-1 flex-col">
            <p
              class="text-[#637588] text-sm font-normal leading-normal pb-3 pt-1 px-4 text-center"
            >
              By creating an account, you agree to our Terms of Service and
              Privacy Policy
            </p>
          </div>
        </footer>
      </div>
    </div>
    <script>
      async function loadSkillsFromServer() {
        try {
          const res = await fetch("http://localhost:5001/api/categories"); // or /api/skills
          const skills = await res.json();

          // Always include "No skills" first
          skills.unshift({ name: "No skills" });

          const container = document.getElementById("skills-container");
          container.innerHTML = "";

          skills.forEach((skill) => {
            const label = document.createElement("label");
            label.className =
              "flex items-center gap-2 p-2 rounded-md cursor-pointer bg-gray-200 hover:bg-[#ee7f2b] peer-checked:bg-[#ee7f2b]";

            label.innerHTML = `
                <input type="checkbox" name="skills" value="${skill.name}" class="peer hidden" />
                <span class="text-black peer-checked:text-white">${skill.name}</span>
              `;

            container.appendChild(label);
          });

          applySkillCheckboxLogic(); // ✅ call logic that controls skill behavior
          const roleSelect = document.querySelector("select");
          if (roleSelect) {
            roleSelect.dispatchEvent(new Event("change"));
          }
        } catch (err) {
          console.error("❌ Failed to load skills:", err);
        }
      }

      function applySkillCheckboxLogic() {
        const container = document.getElementById("skills-container");
        const noSkillsCheckbox = container.querySelector(
          "input[value='No skills']"
        );
        const allCheckboxes = container.querySelectorAll(
          "input[name='skills']"
        );
        const otherCheckboxes = Array.from(allCheckboxes).filter(
          (cb) => cb.value !== "No skills"
        );
        const roleSelect = document.querySelector("select");

        if (!noSkillsCheckbox || !roleSelect) return;

        // Checkbox interaction logic
        noSkillsCheckbox.addEventListener("change", () => {
          if (noSkillsCheckbox.checked) {
            otherCheckboxes.forEach((cb) => {
              cb.checked = false;
            });
          }
        });

        otherCheckboxes.forEach((cb) => {
          cb.addEventListener("change", () => {
            if (cb.checked) {
              noSkillsCheckbox.checked = false;
            }
          });
        });

        // 👇 ROLE-BASED ENABLING/DISABLING
        roleSelect.addEventListener("change", () => {
          const wrapper = document.getElementById("skills-wrapper");
          const role = roleSelect.value;

          if (role === "client") {
            wrapper.classList.remove("hidden"); // optional: you can `add("hidden")` if you prefer hiding
            noSkillsCheckbox.checked = true;

            otherCheckboxes.forEach((cb) => {
              cb.checked = false;
              cb.disabled = true;
              cb.parentElement.classList.add(
                "opacity-50",
                "pointer-events-none"
              );
            });
          } else if (role === "craftsman") {
            wrapper.classList.remove("hidden");
            noSkillsCheckbox.checked = false;

            otherCheckboxes.forEach((cb) => {
              cb.disabled = false;
              cb.parentElement.classList.remove(
                "opacity-50",
                "pointer-events-none"
              );
            });
          }
        });
      }

      document.addEventListener("DOMContentLoaded", () => {
        loadSkillsFromServer();
      });

      function updateSignupStrengthBar() {
        const password = document.getElementById("signupPassword").value;
        const bar = document.getElementById("signup-strength-bar");

        const strength = Math.min(password.length, 8);
        const widthPercent = (strength / 8) * 100;
        bar.style.width = widthPercent + "%";

        if (strength < 4) {
          bar.style.backgroundColor = "#e68019"; // weak = orange
        } else if (strength < 6) {
          bar.style.backgroundColor = "#facc15"; // medium = yellow
        } else {
          bar.style.backgroundColor = "#22c55e"; // strong = green
        }
      }
    </script>
  </body>
</html>
