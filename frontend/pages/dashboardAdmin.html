<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
</head>

<body class="bg-white font-sans">
  <div class="p-6">
    <h1 class="text-4xl font-bold text-gray-800 mb-6">Dashboard</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      <div class="bg-gray-100 shadow-md hover:shadow-lg transition-all p-6 rounded-xl border border-gray-200">
        <p class="text-gray-600 text-sm font-medium">Total Users</p>
        <div class="flex items-end justify-between">
          <p class="text-3xl font-mono font-semibold text-gray-800" id="totalUsers">0</p>
        </div>
      </div>

      <div class="bg-gray-100 p-6 rounded-xl">
        <p class="text-gray-700 font-medium">New Signups (Last 7 Days)</p>
        <p id="newSignups" class="text-2xl font-bold text-gray-900">0</p>
      </div>
      <div class="bg-gray-100 p-6 rounded-xl">
        <p class="text-gray-700 font-medium">Jobs Posted (This Month)</p>
        <p id="jobsPosted" class="text-2xl font-bold text-gray-900">0</p>
      </div>
      <div class="bg-gray-100 p-6 rounded-xl">
        <p class="text-gray-700 font-medium">Revenue Generated</p>
        <p id="revenueGenerated" class="text-2xl font-bold text-gray-900">$0</p>
      </div>
    </div>

    <h2 class="text-2xl font-bold text-gray-800 mt-10 mb-4">User Activity</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="border border-gray-300 p-6 rounded-xl">
        <p class="text-gray-700 font-medium mb-2">Active Users (Last 30 Days)</p>
        <p id="activeUsers" class="text-3xl font-bold text-gray-900 mb-4">0</p>
      </div>
      <div class="border border-gray-300 p-6 rounded-xl">
        <p class="text-gray-700 font-medium mb-2">Clients vs. Craftsmen</p>
        <p id="clientCraftsman" class="text-3xl font-bold text-gray-900 mb-4">0 vs. 0</p>
      </div>

      <div class="border border-gray-300 p-6 rounded-xl">
        <p class="text-gray-700 font-medium mb-2">Users Posted Jobs vs. Got Hired</p>
        <p id="postVsHire" class="text-3xl font-bold text-gray-900 mb-4">0 vs. 0</p>
      </div>


    </div>

    <h2 class="text-2xl font-bold text-gray-800 mt-10 mb-4">Top Skills</h2>
    <div id="skillsBars" class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4 mb-10"></div>

    <h2 class="text-2xl font-bold text-gray-800 mt-10 mb-4">Top Job Categories</h2>
    <div id="jobCategoriesBars" class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4 mb-10"></div>

    <h2 class="text-2xl font-bold text-gray-800 mt-10 mb-4">User Reviews</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <p id="reviewScore" class="text-4xl font-extrabold text-gray-900">0.0</p>
        <p id="reviewCount" class="text-base text-gray-600">0 reviews</p>
        <div class="flex gap-2 mt-4">
          <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
            <div class="review-bar h-2 bg-gray-800" style="width: 0%"></div>
          </div>
          <span class="text-sm text-gray-700">5</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    async function loadDashboardData() {
      try {
        const res = await fetch("/api/dashboard");
        const data = await res.json();

        document.getElementById("totalUsers").textContent = data.totalUsers;
        document.getElementById("newSignups").textContent = data.newSignups;
        document.getElementById("jobsPosted").textContent = data.jobsPosted;
        document.getElementById("revenueGenerated").textContent = `$${data.revenue}`;
        document.getElementById("activeUsers").textContent = data.activeUsers;
        document.getElementById("clientCraftsman").textContent = `${data.clientCount} vs. ${data.craftsmanCount}`;
        document.getElementById("postVsHire").textContent = `${data.usersPosted} vs. ${data.usersHired}`;


        document.getElementById("reviewScore").textContent = data.reviewScore;
        document.getElementById("reviewCount").textContent = `${data.reviewCount} reviews`;

        const skillsContainer = document.getElementById("skillsBars");
        skillsContainer.innerHTML = '';
        data.popularSkills.forEach(skill => {
          skillsContainer.innerHTML += `
              <p class='text-sm font-bold text-gray-700'>${skill.name}</p>
              <div class='w-full h-3 bg-gray-200 rounded-full'>
                <div class='h-3 bg-gray-700 rounded-full' style='width: ${skill.percentage}%'></div>
              </div>`;
        });

        const jobContainer = document.getElementById("jobCategoriesBars");
        jobContainer.innerHTML = '';
        data.jobCategories.forEach(job => {
          jobContainer.innerHTML += `
              <p class='text-sm font-bold text-gray-700'>${job.name}</p>
              <div class='w-full h-3 bg-gray-200 rounded-full'>
                <div class='h-3 bg-gray-700 rounded-full' style='width: ${job.percentage}%'></div>
              </div>`;
        });

        const reviewBars = document.querySelectorAll(".review-bar");
        data.reviewDistribution.forEach((review, index) => {
          if (reviewBars[index]) {
            reviewBars[index].style.width = `${review.percentage}%`;
          }
        });
      } catch (err) {
        console.error("Failed to load dashboard data", err);
      }
    }

    window.onload = loadDashboardData;
  </script>
</body>

</html>